syntax = "proto3";

package vinbero.v1;

import "vinbero/v1/enums.proto";

option go_package = "github.com/takehaya/vinbero/api/vinbero/v1;vinberov1";

service SidFunctionService {
  rpc SidFunctionCreate(SidFunctionCreateRequest) returns (SidFunctionCreateResponse);
  rpc SidFunctionDelete(SidFunctionDeleteRequest) returns (SidFunctionDeleteResponse);
  rpc SidFunctionList(SidFunctionListRequest) returns (SidFunctionListResponse);
  rpc SidFunctionGet(SidFunctionGetRequest) returns (SidFunctionGetResponse);
}

// SidFunction represents SRv6 Endpoint functions (End, End.X, End.DX4, End.DX6, etc.)
message SidFunction {
  Srv6LocalAction action = 1;
  string trigger_prefix = 2; // CIDR format (e.g., fd00::1/128)
  string src_addr = 3; // actionSrcAddr
  string dst_addr = 4; // actionDstAddr
  string nexthop = 5;
  Srv6LocalFlavor flavor = 6; // PSP, USP, USD, etc.
  uint32 arg_src_offset = 7; // Bit offset for source in SID Args
  uint32 arg_dst_offset = 8; // Bit offset for destination in SID Args
}

message SidFunctionCreateRequest {
  repeated SidFunction sid_functions = 1;
}
message SidFunctionCreateResponse {
  repeated SidFunction created = 1;
  repeated OperationError errors = 2;
}

message SidFunctionDeleteRequest {
  repeated string trigger_prefixes = 1;
}
message SidFunctionDeleteResponse {
  repeated string deleted_trigger_prefixes = 1;
  repeated OperationError errors = 2;
}

message SidFunctionListRequest {}
message SidFunctionListResponse {
  repeated SidFunction sid_functions = 1;
}

message SidFunctionGetRequest {
  string trigger_prefix = 1;
}
message SidFunctionGetResponse {
  SidFunction sid_function = 1;
}

service Headendv4Service {
  rpc Headendv4Create(Headendv4CreateRequest) returns (Headendv4CreateResponse);
  rpc Headendv4Delete(Headendv4DeleteRequest) returns (Headendv4DeleteResponse);
  rpc Headendv4List(Headendv4ListRequest) returns (Headendv4ListResponse);
  rpc Headendv4Get(Headendv4GetRequest) returns (Headendv4GetResponse);
}

// Headendv4 represents Headend behavior for IPv4 packets
message Headendv4 {
  Srv6HeadendBehavior mode = 1;
  string trigger_prefix = 2; // CIDR format (e.g., 10.0.0.0/24)
  string src_addr = 3;
  string dst_addr = 4;
  repeated string segments = 5;
}
message Headendv4CreateRequest {
  repeated Headendv4 headendv4s = 1;
}
message Headendv4CreateResponse {
  repeated Headendv4 created = 1;
  repeated OperationError errors = 2;
}

message Headendv4DeleteRequest {
  repeated string trigger_prefixes = 1;
}
message Headendv4DeleteResponse {
  repeated string deleted_trigger_prefixes = 1;
  repeated OperationError errors = 2;
}

message Headendv4ListRequest {}
message Headendv4ListResponse {
  repeated Headendv4 headendv4s = 1;
}

message Headendv4GetRequest {
  string trigger_prefix = 1;
}
message Headendv4GetResponse {
  Headendv4 headendv4 = 1;
}

service Headendv6Service {
  rpc Headendv6Create(Headendv6CreateRequest) returns (Headendv6CreateResponse);
  rpc Headendv6Delete(Headendv6DeleteRequest) returns (Headendv6DeleteResponse);
  rpc Headendv6List(Headendv6ListRequest) returns (Headendv6ListResponse);
  rpc Headendv6Get(Headendv6GetRequest) returns (Headendv6GetResponse);
}

// Headendv6 represents Headend behavior for IPv6 packets
message Headendv6 {
  Srv6HeadendBehavior mode = 1;
  string trigger_prefix = 2; // CIDR format (e.g., 2001:db8::/32)
  string src_addr = 3;
  string dst_addr = 4;
  repeated string segments = 5;
}

message Headendv6CreateRequest {
  repeated Headendv6 headendv6s = 1;
}
message Headendv6CreateResponse {
  repeated Headendv6 created = 1;
  repeated OperationError errors = 2;
}

message Headendv6DeleteRequest {
  repeated string trigger_prefixes = 1;
}
message Headendv6DeleteResponse {
  repeated string deleted_trigger_prefixes = 1;
  repeated OperationError errors = 2;
}

message Headendv6ListRequest {}
message Headendv6ListResponse {
  repeated Headendv6 headendv6s = 1;
}

message Headendv6GetRequest {
  string trigger_prefix = 1;
}
message Headendv6GetResponse {
  Headendv6 headendv6 = 1;
}
